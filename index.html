<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Diatom Guy Adventure</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    overflow: hidden;
    background: #000;
    width: 100vw;
    height: 100vh;
    user-select: none;
    -webkit-user-select: none;
  }

  #game {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
  }

  /* ---- Scene 1 ---- */
  #scene1 {
    position: absolute;
    inset: 0;
    transition: opacity 0.6s ease;
  }

  #scene1-bg {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  #diatom-guy {
    position: absolute;
    left: 8%;
    bottom: 10%;
    height: 35%;
    z-index: 2;
    transition: opacity 0.3s ease;
  }

  #diatom-guy-with-hat {
    position: absolute;
    left: 8%;
    bottom: 10%;
    height: 35%;
    z-index: 2;
    display: none;
    cursor: grab;
  }

  #hat {
    position: absolute;
    left: 5%;
    bottom: 38%;
    height: 14%;
    z-index: 3;
    cursor: pointer;
    animation: bob 2s ease-in-out infinite;
  }

  #door {
    position: absolute;
    right: 10%;
    bottom: 8%;
    height: 45%;
    z-index: 2;
    display: none;
    opacity: 0;
    transition: opacity 0.5s ease;
  }

  @keyframes bob {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-12px); }
  }

  @keyframes bobSlow {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
  }

  .bobbing {
    animation: bobSlow 2.5s ease-in-out infinite;
  }

  /* ---- Scene 2 ---- */
  #scene2 {
    position: absolute;
    inset: 0;
    display: none;
    background: linear-gradient(to bottom, #1a1a2e 0%, #16213e 40%, #0f3460 70%, #1a1a2e 100%);
  }

  #scene2-house {
    position: absolute;
    left: 8%;
    bottom: 10%;
    height: 70%;
    z-index: 2;
    opacity: 0;
    transition: opacity 0.6s ease;
  }

  #scene2-diatom {
    position: absolute;
    left: 18%;
    bottom: 10%;
    height: 30%;
    z-index: 3;
    opacity: 0;
    transition: opacity 0.6s ease;
    animation: bobSlow 2.5s ease-in-out infinite;
  }

  #scene2-car {
    position: absolute;
    left: 50%;
    bottom: 6%;
    height: 18%;
    transform: translateX(-50%);
    z-index: 4;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.6s ease;
  }

  #scene2-car-with-driver {
    position: absolute;
    left: 50%;
    bottom: 6%;
    height: 18%;
    transform: translateX(-50%);
    z-index: 4;
    display: none;
  }

  @keyframes shake {
    0%, 100% { transform: translateX(-50%) translateY(0) rotate(0deg); }
    10% { transform: translateX(-50%) translateY(-1px) rotate(-0.5deg); }
    20% { transform: translateX(-50%) translateY(1px) rotate(0.5deg); }
    30% { transform: translateX(-50%) translateY(-1px) rotate(-0.3deg); }
    40% { transform: translateX(-50%) translateY(1px) rotate(0.3deg); }
    50% { transform: translateX(-50%) translateY(-1px) rotate(-0.5deg); }
    60% { transform: translateX(-50%) translateY(1px) rotate(0.5deg); }
    70% { transform: translateX(-50%) translateY(-1px) rotate(-0.3deg); }
    80% { transform: translateX(-50%) translateY(1px) rotate(0.3deg); }
    90% { transform: translateX(-50%) translateY(-1px) rotate(-0.5deg); }
  }

  @keyframes driveOff {
    0% { transform: translateX(-50%); }
    100% { transform: translateX(120vw); }
  }

  /* Stars for scene 2 background */
  #scene2::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      radial-gradient(1px 1px at 10% 15%, rgba(255,255,255,0.6), transparent),
      radial-gradient(1px 1px at 25% 8%, rgba(255,255,255,0.5), transparent),
      radial-gradient(1.5px 1.5px at 40% 20%, rgba(255,255,255,0.7), transparent),
      radial-gradient(1px 1px at 55% 5%, rgba(255,255,255,0.4), transparent),
      radial-gradient(1px 1px at 70% 18%, rgba(255,255,255,0.6), transparent),
      radial-gradient(1.5px 1.5px at 85% 12%, rgba(255,255,255,0.5), transparent),
      radial-gradient(1px 1px at 15% 30%, rgba(255,255,255,0.3), transparent),
      radial-gradient(1px 1px at 50% 25%, rgba(255,255,255,0.5), transparent),
      radial-gradient(1px 1px at 90% 28%, rgba(255,255,255,0.4), transparent),
      radial-gradient(1.5px 1.5px at 35% 35%, rgba(255,255,255,0.6), transparent);
    z-index: 0;
  }

  /* Ground for scene 2 */
  #scene2::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 12%;
    background: linear-gradient(to bottom, #1a1a2e, #111);
    z-index: 1;
  }

  /* Drag visual feedback */
  .dragging {
    cursor: grabbing !important;
    opacity: 0.85;
    z-index: 100 !important;
  }

  /* Door glow hint when dragging */
  .door-glow {
    filter: drop-shadow(0 0 15px rgba(255, 220, 100, 0.8));
  }
</style>
</head>
<body>
<div id="game">

  <!-- Scene 1 -->
  <div id="scene1">
    <img id="scene1-bg" src="assets/inside-scene2.jpg" alt="Inside scene background">
    <img id="diatom-guy" src="assets/diatom-guy.png" alt="Diatom Guy">
    <img id="diatom-guy-with-hat" src="assets/diatom-guy-with-hat.png" alt="Diatom Guy with Hat">
    <img id="hat" src="assets/hat.png" alt="Hat">
    <img id="door" src="assets/door.png" alt="Door">
  </div>

  <!-- Scene 2 -->
  <div id="scene2">
    <img id="scene2-house" src="assets/house.png" alt="House">
    <img id="scene2-diatom" src="assets/diatom-guy-with-hat.png" alt="Diatom Guy with Hat">
    <img id="scene2-car" src="assets/car.png" alt="Car">
    <img id="scene2-car-with-driver" src="assets/car-with-driver.png" alt="Car with Driver">
  </div>

</div>

<script>
(function () {
  // ---- Element references ----
  const scene1 = document.getElementById('scene1');
  const scene2 = document.getElementById('scene2');
  const diatomGuy = document.getElementById('diatom-guy');
  const diatomGuyWithHat = document.getElementById('diatom-guy-with-hat');
  const hat = document.getElementById('hat');
  const door = document.getElementById('door');

  const scene2House = document.getElementById('scene2-house');
  const scene2Diatom = document.getElementById('scene2-diatom');
  const scene2Car = document.getElementById('scene2-car');
  const scene2CarWithDriver = document.getElementById('scene2-car-with-driver');

  // ---- Scene 1: Hat click ----
  hat.addEventListener('click', function () {
    // Hide the plain diatom guy and the hat
    diatomGuy.style.display = 'none';
    hat.style.display = 'none';

    // Show diatom guy with hat, bobbing
    diatomGuyWithHat.style.display = 'block';
    diatomGuyWithHat.classList.add('bobbing');

    // Show the door with a fade in
    door.style.display = 'block';
    // Force reflow so transition fires
    door.offsetHeight;
    door.style.opacity = '1';
  });

  // ---- Scene 1: Drag diatom-guy-with-hat to door ----
  let isDragging = false;
  let dragOffsetX = 0;
  let dragOffsetY = 0;

  function startDrag(e) {
    if (diatomGuyWithHat.style.display === 'none') return;
    isDragging = true;
    diatomGuyWithHat.classList.add('dragging');
    diatomGuyWithHat.classList.remove('bobbing');

    const rect = diatomGuyWithHat.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    dragOffsetX = clientX - rect.left;
    dragOffsetY = clientY - rect.top;

    // Switch to absolute positioning from pointer
    diatomGuyWithHat.style.bottom = 'auto';
    diatomGuyWithHat.style.left = rect.left + 'px';
    diatomGuyWithHat.style.top = rect.top + 'px';

    e.preventDefault();
  }

  function moveDrag(e) {
    if (!isDragging) return;
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;

    diatomGuyWithHat.style.left = (clientX - dragOffsetX) + 'px';
    diatomGuyWithHat.style.top = (clientY - dragOffsetY) + 'px';

    // Check proximity to door for glow effect
    if (door.style.display !== 'none') {
      const doorRect = door.getBoundingClientRect();
      const diatomRect = diatomGuyWithHat.getBoundingClientRect();
      const dist = getDistance(diatomRect, doorRect);
      if (dist < 80) {
        door.classList.add('door-glow');
      } else {
        door.classList.remove('door-glow');
      }
    }

    e.preventDefault();
  }

  function endDrag(e) {
    if (!isDragging) return;
    isDragging = false;
    diatomGuyWithHat.classList.remove('dragging');

    // Check overlap with door
    const doorRect = door.getBoundingClientRect();
    const diatomRect = diatomGuyWithHat.getBoundingClientRect();
    const dist = getDistance(diatomRect, doorRect);

    if (dist < 80) {
      // Transition to Scene 2
      transitionToScene2();
    } else {
      // Snap back
      diatomGuyWithHat.style.left = '8%';
      diatomGuyWithHat.style.top = '';
      diatomGuyWithHat.style.bottom = '10%';
      diatomGuyWithHat.classList.add('bobbing');
    }

    door.classList.remove('door-glow');
  }

  function getDistance(r1, r2) {
    const cx1 = r1.left + r1.width / 2;
    const cy1 = r1.top + r1.height / 2;
    const cx2 = r2.left + r2.width / 2;
    const cy2 = r2.top + r2.height / 2;
    return Math.sqrt((cx1 - cx2) ** 2 + (cy1 - cy2) ** 2);
  }

  diatomGuyWithHat.addEventListener('mousedown', startDrag);
  diatomGuyWithHat.addEventListener('touchstart', startDrag);
  document.addEventListener('mousemove', moveDrag);
  document.addEventListener('touchmove', moveDrag, { passive: false });
  document.addEventListener('mouseup', endDrag);
  document.addEventListener('touchend', endDrag);

  // ---- Transition to Scene 2 ----
  function transitionToScene2() {
    // Fade out scene 1
    scene1.style.opacity = '0';

    setTimeout(function () {
      scene1.style.display = 'none';
      scene2.style.display = 'block';

      // Stagger the scene 2 elements appearing
      setTimeout(function () {
        scene2House.style.opacity = '1';
      }, 200);

      setTimeout(function () {
        scene2Diatom.style.opacity = '1';
      }, 600);

      setTimeout(function () {
        scene2Car.style.opacity = '1';
      }, 1000);
    }, 600);
  }

  // ---- Scene 2: Car click ----
  scene2Car.addEventListener('click', function () {
    // Hide diatom guy
    scene2Diatom.style.transition = 'opacity 0.4s ease';
    scene2Diatom.style.opacity = '0';

    setTimeout(function () {
      scene2Diatom.style.display = 'none';

      // Swap car for car with driver
      const carRect = scene2Car.getBoundingClientRect();
      scene2Car.style.display = 'none';

      scene2CarWithDriver.style.display = 'block';
      scene2CarWithDriver.style.left = scene2Car.style.left || '50%';
      scene2CarWithDriver.style.bottom = scene2Car.style.bottom || '6%';

      // Shake the car
      scene2CarWithDriver.style.animation = 'shake 0.15s ease-in-out infinite';

      // After 1 second, drive off screen to the right
      setTimeout(function () {
        scene2CarWithDriver.style.animation = 'driveOff 1.5s ease-in forwards';
      }, 1000);
    }, 400);
  });
})();
</script>
</body>
</html>
